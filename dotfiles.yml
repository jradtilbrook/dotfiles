#!/usr/bin/env ansible-playbook

## -------------------------------------------------------------------------------
## Ansible playbook for setting up a new machine
##
## This handles the 3 platforms that I generally use; Arch Linux, Ubuntu and MacOS
## -------------------------------------------------------------------------------

---
## -------------------------
## Arch Linux specific tasks
## -------------------------
- name: Configure Arch Linux
  hosts: archlinux
  tags: archlinux
  gather_facts: no
  become: yes
  tasks:
    - import_tasks: tasks/archlinux.yml


## ---------------------
## Ubuntu specific tasks
## ---------------------
- name: Configure Ubuntu
  hosts: ubuntu
  tags: ubuntu
  gather_facts: no
  become: yes
  tasks:
    - import_tasks: tasks/ubuntu.yml


## --------------------
## MacOS specific tasks
## --------------------
- name: Configure MacOS
  hosts: macos
  tags: macos
  gather_facts: no
  handlers:
    - name: restart dock
      command: killall Dock
      listen: restart mac services
    - name: restart mac services
      command: killall {{ item }}
      loop:
        - Finder
        - Safari
        - SystemUIServer
        - cfprefsd
  tasks:
    - import_tasks: tasks/macbook.yml


## -----------------------
## Platform agnostic tasks
## -----------------------
- name: Configure common stuff
  hosts: all
  tags: common
  tasks:
    - import_tasks: tasks/atom.yml
      tags: atom
    - import_tasks: tasks/dotfiles.yml
      tags: dotfiles
    - import_tasks: tasks/python.yml
      become: "{% if ansible_distribution == 'MacOSX' %}no{% else %}yes{% endif %}"
      tags: python
    - import_tasks: tasks/node.yml
      become: "{% if ansible_distribution == 'MacOSX' %}no{% else %}yes{% endif %}"
      tags: node
    - import_tasks: tasks/ruby.yml
      tags: ruby
    - import_tasks: tasks/ssh.yml
      tags: ssh
    - import_tasks: tasks/vim.yml
      tags: vim
